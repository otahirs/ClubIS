@page "/settings"

@attribute [Authorize]

@using ClubIS.Web.Components

@inject HttpClient Http
@inject IdentityAuthenticationStateProvider authStateProvider

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-16">
    <MudText Typo="Typo.h3" GutterBottom="true">Settings</MudText>
    <MudTabs>
        <MudTabPanel Text="User">
            @if (CurrentUser != null)
            {<UserEditForm User="CurrentUser" />}
            else
            { <MudProgressCircular Color="Color.Default" Indeterminate="true" />}
        </MudTabPanel>
        <MudTabPanel Text="SI Cards">
            @if (CurrentUser != null)
            {<SICardsForm User="CurrentUser" />}
            else
            { <MudProgressCircular Color="Color.Default" Indeterminate="true" />}
        </MudTabPanel>
        <MudTabPanel Text="Login">
            <LoginEditForm EditedUserId="CurrentUser.Id" />
        </MudTabPanel>
        <MudTabPanel Text="Supervision">
            @if (CurrentUser != null)
            { <Supervisors UserId="CurrentUser.Id" isAdmin="false" /> }
            else
            { <MudProgressCircular Color="Color.Default" Indeterminate="true" /> }
        </MudTabPanel>
    </MudTabs>
</MudContainer>

@code {
    private UserDTO CurrentUser;

    protected override async Task OnInitializedAsync()
    {
        var currentUserId = await authStateProvider.GetUserId();
        CurrentUser = await Http.GetFromJsonAsync<UserDTO>($"Users/{currentUserId}");
    }
}